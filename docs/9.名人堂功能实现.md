# 名人堂功能实现

## 功能概述

名人堂功能用于展示历史总排名前5的用户，根据所有历史周期的排名综合计算积分，展示最具毅力的挑战者。

## 核心功能

### 1. 积分计算规则
- **第1名（冠军）**：5分
- **第2名（亚军）**：3分
- **第3名（季军）**：2分
- **参与奖**：1分

### 2. 排名展示
- **Top 3 特殊展示**：
  - 第1名：金色渐变背景、"殿堂之王"徽章、皇冠图标
  - 第2名：银色渐变背景、"名人堂银冠"徽章、奖牌图标
  - 第3名：橙色渐变背景、"名人堂铜冠"徽章、奖牌图标
  - 显示总积分（大号字体）
  - 显示获奖统计：冠军、亚军、季军、参与周数（4列网格）
- **Rank 4-5 列表展示**：
  - 简洁的卡片样式
  - 显示排名、头像、昵称、获奖统计、总积分

### 3. 用户交互
- 点击头像或昵称跳转到用户个人主页
- 悬停效果

### 4. 积分规则说明
- 在页面底部以小字显示积分规则说明

## API 接口

### 获取名人堂数据
**路径**：`GET /api/hall-of-fame`

**功能**：查询所有用户的积分统计，按总积分排序，返回前5名

**返回数据**：
```typescript
{
  code: 200,
  msg: 'success',
  data: {
    users: Array<{
      rank: number,              // 名人堂排名（1-5）
      userId: number,            // 用户ID
      nickname: string,          // 昵称
      avatar: string | null,     // 头像URL
      champion: number,          // 冠军次数
      runnerUp: number,          // 亚军次数
      third: number,             // 季军次数
      participant: number,       // 参与奖次数
      totalScore: number,        // 总积分
      totalWeeks: number         // 参与周数
    }>
  }
}
```

## 关键逻辑

### 1. 数据来源
- 从 `rewards` 表查询所有历史奖励记录
- 实时计算，不存储汇总表

### 2. 积分计算
- 根据 `type` 字段计算积分：
  - `type = 1`（冠军）→ 5分
  - `type = 2`（亚军）→ 3分
  - `type = 3`（季军）→ 2分
  - `type = 4`（参与奖）→ 1分

### 3. 排名规则
1. 按总积分降序排列
2. 如果总积分相同，按参与周数降序排列（参与周数多的排名靠前）
3. 如果都相同，按用户ID升序排列（保证排序稳定）

### 4. 统计计算
- 按用户分组统计：
  - 冠军数量：`COUNT(type = 1)`
  - 亚军数量：`COUNT(type = 2)`
  - 季军数量：`COUNT(type = 3)`
  - 参与奖数量：`COUNT(type = 4)`
  - 参与周数：`COUNT(*)`（所有奖励记录数）
  - 总积分：`SUM(calculateScore(type))`

### 5. 数据限制
- 只返回前5名用户
- 如果用户少于5个，只显示实际用户数

## 数据字段说明

### rewards 表字段
- `user_id`：用户ID
- `type`：奖励类型（1=冠军，2=亚军，3=季军，4=参与奖）
- `week_number`：周编号（用于统计参与周数）

### 用户信息字段
- `nickname`：用户昵称（如果没有则显示"用户{userId}"）
- `avatar`：头像URL（如果没有则为null）

## 实现方式

### 实时计算
- 每次查询时从 `rewards` 表实时计算积分
- 使用内存分组和统计，性能足够
- 如果后续数据量大，可以考虑添加缓存或汇总表

### 查询优化
- 使用 `Map` 数据结构进行分组统计
- 一次性查询所有奖励记录，在内存中计算
- 如果数据量大，可以考虑使用 SQL 聚合查询优化

## 注意事项

1. **数据一致性**：只统计 `rewards` 表中已结算的数据
2. **空数据处理**：如果用户少于5个，只显示实际用户数
3. **性能考虑**：如果数据量大（用户数超过1000），可以考虑：
   - 添加缓存（Redis 或内存缓存，缓存5-10分钟）
   - 创建汇总表（定期更新）
4. **排名更新**：每次结算后，名人堂排名可能会变化，但不需要实时更新，可以按需刷新


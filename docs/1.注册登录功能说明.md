# 注册登录功能实现说明

## ✅ 已完成功能

### 1. 数据库模型
- ✅ `users` 表：用户基本信息
- ✅ `user_auths` 表：用户授权信息（支持多种登录方式）
- ✅ `verification_codes` 表：验证码存储（5分钟过期）

### 2. API 接口

#### 发送验证码 API
- **路径**：`POST /api/auth/send-code`
- **功能**：
  - 验证手机号格式（11位，1开头）
  - 防刷检查（60秒内不能重复发送）
  - 生成6位随机验证码
  - 存入数据库（5分钟过期）
  - 返回验证码（开发阶段，模拟短信）

#### 登录/注册 API
- **路径**：`POST /api/auth/login`
- **功能**：
  - 验证验证码（检查是否有效且未过期）
  - 自动注册新用户（首次登录）
  - 更新老用户登录时间
  - 生成 JWT Token（永久有效）
  - 返回用户信息和登录状态

### 3. 前端页面

#### 登录页面 (`/login`)
- ✅ 参考原项目 UI 设计
- ✅ 手机号输入（支持国家代码选择）
- ✅ 验证码输入
- ✅ 获取验证码按钮（带60秒倒计时）
- ✅ 验证码弹框显示（模拟短信）
- ✅ 登录/注册按钮
- ✅ 表单验证

#### 主页 (`/home`)
- ✅ 空白主页（待开发功能）
- ✅ 显示用户信息
- ✅ 退出登录功能

#### 首页 (`/`)
- ✅ 自动重定向到登录页或主页

### 4. 状态管理
- ✅ Zustand 认证状态管理
- ✅ Token 持久化存储（localStorage）
- ✅ 用户信息存储

## 🚀 使用说明

### 1. 配置数据库

在 `.env` 文件中配置数据库连接：

```env
DATABASE_URL="mysql://user:password@localhost:3306/weighin"
JWT_SECRET="your-secret-key-change-in-production"
```

### 2. 运行数据库迁移

```bash
npx prisma migrate dev --name init
```

### 3. 启动开发服务器

```bash
npm run dev
```

### 4. 测试流程

1. 访问 `http://localhost:3000`，会自动跳转到登录页
2. 输入手机号（11位，1开头）
3. 点击"获取验证码"
4. 验证码会以弹框形式显示（模拟短信）
5. 输入验证码，点击"登录/注册"
6. 首次登录会自动注册，跳转到主页
7. 再次登录会直接进入主页

## 📝 注意事项

1. **验证码存储**：验证码存储在 MySQL 表中，5分钟后自动过期
2. **防刷机制**：同一手机号60秒内只能发送一次验证码
3. **Token 有效期**：JWT Token 永久有效（不设置过期时间）
4. **自动注册**：新手机号首次登录会自动创建用户账号
5. **验证码显示**：开发阶段验证码会以弹框形式显示，方便测试

## 🔄 下一步开发

- [ ] 完善主页功能（Dashboard）
- [ ] 实现打卡功能
- [ ] 实现排行榜功能
- [ ] 实现个人主页功能
- [ ] 实现名人堂功能


# WeighIn æŠ€æœ¯è·¯çº¿æ–‡æ¡£

## ğŸ“‹ ç›®å½•
1. [æŠ€æœ¯é€‰å‹](#æŠ€æœ¯é€‰å‹)
2. [é¡¹ç›®æ¶æ„](#é¡¹ç›®æ¶æ„)
3. [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
4. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
5. [API è®¾è®¡](#api-è®¾è®¡)
6. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
7. [å¼€å‘æµç¨‹](#å¼€å‘æµç¨‹)
8. [éƒ¨ç½²æ–¹æ¡ˆ](#éƒ¨ç½²æ–¹æ¡ˆ)

---

## ğŸ¯ æŠ€æœ¯é€‰å‹

### é€‰æ‹© Next.js çš„åŸå› 

#### 1. **å…¨æ ˆå¼€å‘èƒ½åŠ›**
- **API Routes**ï¼šåœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­ç¼–å†™åç«¯æ¥å£ï¼Œæ— éœ€å•ç‹¬çš„åç«¯æœåŠ¡
- **ç»Ÿä¸€æŠ€æœ¯æ ˆ**ï¼šå‰åç«¯éƒ½ä½¿ç”¨ TypeScript/JavaScriptï¼Œé™ä½å­¦ä¹ æˆæœ¬
- **ç®€åŒ–éƒ¨ç½²**ï¼šå‰åç«¯éƒ¨ç½²åœ¨ä¸€èµ·ï¼Œå‡å°‘è¿ç»´å¤æ‚åº¦

#### 2. **é€‚åˆ H5 åº”ç”¨**
- **App Router**ï¼šä½¿ç”¨ Next.js 16+ çš„ App Routerï¼Œæ”¯æŒå®¢æˆ·ç«¯ç»„ä»¶
- **æ–‡ä»¶è·¯ç”±**ï¼šè‡ªåŠ¨è·¯ç”±ç®¡ç†ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®è·¯ç”±è¡¨
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå†…ç½®ä»£ç åˆ†å‰²ã€å›¾ç‰‡ä¼˜åŒ–ç­‰
- **å®‰å…¨æ€§**ï¼šä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ï¼Œæ— å·²çŸ¥å®‰å…¨æ¼æ´

#### 3. **å¼€å‘ä½“éªŒ**
- **çƒ­æ›´æ–°**ï¼šå¿«é€Ÿå¼€å‘ä½“éªŒ
- **TypeScript æ”¯æŒ**ï¼šå®Œæ•´çš„ç±»å‹æ£€æŸ¥
- **ç”Ÿæ€ä¸°å¯Œ**ï¼šå¤§é‡ç°æˆçš„ç»„ä»¶å’Œå·¥å…·

#### 4. **ç”Ÿäº§ç¯å¢ƒä¼˜åŠ¿**
- **è‡ªåŠ¨ä¼˜åŒ–**ï¼šä»£ç åˆ†å‰²ã€Tree Shaking
- **SEO æ”¯æŒ**ï¼šå¦‚éœ€åç»­æ”¯æŒ SEOï¼Œå¯ä»¥è½»æ¾å¯ç”¨ SSR
- **éƒ¨ç½²ç®€å•**ï¼šæ”¯æŒ Vercelã€Docker ç­‰å¤šç§éƒ¨ç½²æ–¹å¼

---

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Next.js Application            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Frontend    â”‚    â”‚   API Routes â”‚  â”‚
â”‚  â”‚   (React)     â”‚â—„â”€â”€â”€â”¤   (Backend)  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                             â”‚          â”‚
â”‚                             â–¼          â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚                        â”‚ Database â”‚    â”‚
â”‚                        â”‚ (MySQL)  â”‚    â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµå‘

1. **ç”¨æˆ·æ“ä½œ** â†’ React ç»„ä»¶
2. **ç»„ä»¶è°ƒç”¨** â†’ API Routesï¼ˆ`/app/api/*`ï¼‰
3. **API Routes** â†’ æ•°æ®åº“æ“ä½œ
4. **æ•°æ®åº“** â†’ è¿”å›æ•°æ®
5. **API Routes** â†’ è¿”å› JSON
6. **React ç»„ä»¶** â†’ æ›´æ–° UI

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### å‰ç«¯æŠ€æœ¯
- **æ¡†æ¶**ï¼šNext.js 16+ (App Router)
- **UI åº“**ï¼šReact 19
- **æ ·å¼**ï¼šTailwind CSS 4
- **ç»„ä»¶åº“**ï¼šshadcn/uiï¼ˆåŸºäº Radix UI + Tailwind CSSï¼‰
- **å›¾æ ‡**ï¼šLucide React
- **å›¾è¡¨**ï¼šshadcn/ui Chart ç»„ä»¶ï¼ˆåŸºäº Recharts å°è£…ï¼‰
- **è¡¨å•**ï¼šReact Hook Form + shadcn/ui Form + Zodï¼ˆéªŒè¯ï¼‰
- **çŠ¶æ€ç®¡ç†**ï¼šZustandï¼ˆè½»é‡çº§ã€ç®€å•æ˜“ç”¨ï¼‰

### åç«¯æŠ€æœ¯
- **API æ¡†æ¶**ï¼šNext.js API Routes
- **è¿è¡Œæ—¶**ï¼šNode.js
- **è¯­è¨€**ï¼šTypeScript

### æ•°æ®åº“
- **æ•°æ®åº“**ï¼šMySQL 8.0+ï¼ˆå•ä¸€æ•°æ®åº“ï¼Œç®€åŒ–éƒ¨ç½²ï¼‰
- **ORM**ï¼šPrismaï¼ˆæ¨èï¼‰
- **ç¼“å­˜**ï¼šå¯é€‰ Redisï¼ˆéªŒè¯ç å¯å­˜å‚¨åœ¨ MySQL è¡¨ä¸­ï¼Œå¸¦è¿‡æœŸæ—¶é—´ï¼‰

### å¼€å‘å·¥å…·
- **åŒ…ç®¡ç†**ï¼špnpm / npm
- **ä»£ç æ£€æŸ¥**ï¼šESLint
- **ç±»å‹æ£€æŸ¥**ï¼šTypeScript
- **Git**ï¼šç‰ˆæœ¬æ§åˆ¶

---

## ğŸ“ é¡¹ç›®ç»“æ„

### Next.js App Router ç»“æ„

```
weighin-app/
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ layout.tsx               # æ ¹å¸ƒå±€ï¼ˆå¯¼èˆªæ ã€åº•éƒ¨æ ï¼‰
â”‚   â”œâ”€â”€ page.tsx                  # é¦–é¡µï¼ˆç™»å½•/é¦–é¡µï¼‰
â”‚   â”œâ”€â”€ (auth)/                   # è®¤è¯ç›¸å…³è·¯ç”±ç»„
â”‚   â”‚   â””â”€â”€ login/
â”‚   â”‚       â””â”€â”€ page.tsx          # ç™»å½•é¡µé¢
â”‚   â”œâ”€â”€ (main)/                   # ä¸»åº”ç”¨è·¯ç”±ç»„
â”‚   â”‚   â”œâ”€â”€ home/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx          # é¦–é¡µï¼ˆDashboardï¼‰
â”‚   â”‚   â”œâ”€â”€ checkin/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx          # æ‰“å¡é¡µé¢
â”‚   â”‚   â”œâ”€â”€ leaderboard/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx          # æ’è¡Œæ¦œ
â”‚   â”‚   â”œâ”€â”€ profile/
â”‚   â”‚   â”‚   â””â”€â”€ [userId]/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx      # ä¸ªäººä¸»é¡µï¼ˆæ”¯æŒåŠ¨æ€è·¯ç”±ï¼‰
â”‚   â”‚   â””â”€â”€ halloffame/
â”‚   â”‚       â””â”€â”€ page.tsx          # åäººå ‚
â”‚   â”œâ”€â”€ api/                      # API Routes
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ send-code/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts      # POST /api/auth/send-code
â”‚   â”‚   â”‚   â””â”€â”€ login/
â”‚   â”‚   â”‚       â””â”€â”€ route.ts      # POST /api/auth/login
â”‚   â”‚   â”œâ”€â”€ checkin/
â”‚   â”‚   â”‚   â”œâ”€â”€ route.ts          # POST /api/checkin
â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚       â””â”€â”€ route.ts      # PUT /api/checkin/[id]
â”‚   â”‚   â”œâ”€â”€ leaderboard/
â”‚   â”‚   â”‚   â””â”€â”€ route.ts          # GET /api/leaderboard?week=51
â”‚   â”‚   â”œâ”€â”€ profile/
â”‚   â”‚   â”‚   â””â”€â”€ [userId]/
â”‚   â”‚   â”‚       â””â”€â”€ route.ts      # GET /api/profile/[userId]
â”‚   â”‚   â””â”€â”€ admin/
â”‚   â”‚       â””â”€â”€ route.ts          # ç®¡ç†å‘˜æ¥å£
â”‚   â””â”€â”€ admin/
â”‚       â””â”€â”€ page.tsx              # åå°ç®¡ç†é¡µé¢
â”‚
â”œâ”€â”€ components/                    # React ç»„ä»¶
â”‚   â”œâ”€â”€ ui/                       # shadcn/ui ç»„ä»¶ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”œâ”€â”€ chart.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ Dashboard.tsx
â”‚   â”œâ”€â”€ CheckInPage.tsx
â”‚   â”œâ”€â”€ Leaderboard.tsx
â”‚   â”œâ”€â”€ ProfilePage.tsx
â”‚   â”œâ”€â”€ HallOfFame.tsx
â”‚   â””â”€â”€ AdminPanel.tsx
â”‚
â”œâ”€â”€ lib/                          # å·¥å…·å‡½æ•°å’Œé…ç½®
â”‚   â”œâ”€â”€ db.ts                     # æ•°æ®åº“è¿æ¥ï¼ˆPrisma Clientï¼‰
â”‚   â”œâ”€â”€ auth.ts                   # è®¤è¯å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ utils.ts                  # é€šç”¨å·¥å…·å‡½æ•°ï¼ˆshadcn å·¥å…·å‡½æ•°ï¼‰
â”‚
â”œâ”€â”€ store/                        # Zustand çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ auth-store.ts             # è®¤è¯çŠ¶æ€ï¼ˆç”¨æˆ·ä¿¡æ¯ã€Tokenï¼‰
â”‚   â”œâ”€â”€ checkin-store.ts          # æ‰“å¡çŠ¶æ€
â”‚   â”œâ”€â”€ leaderboard-store.ts      # æ’è¡Œæ¦œçŠ¶æ€
â”‚   â””â”€â”€ ui-store.ts               # UI çŠ¶æ€ï¼ˆå½“å‰é¡µé¢ã€å¯¼èˆªç­‰ï¼‰
â”‚
â”œâ”€â”€ prisma/                       # Prisma é…ç½®
â”‚   â”œâ”€â”€ schema.prisma             # æ•°æ®åº“æ¨¡å‹å®šä¹‰
â”‚   â””â”€â”€ migrations/               # æ•°æ®åº“è¿ç§»æ–‡ä»¶
â”‚
â”œâ”€â”€ public/                       # é™æ€èµ„æº
â”‚   â”œâ”€â”€ images/
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ styles/                       # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ globals.css
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ types/                        # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ user.ts
â”‚   â”œâ”€â”€ checkin.ts
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ package.json
â”œâ”€â”€ next.config.js
â”œâ”€â”€ tsconfig.json
â””â”€â”€ .env                          # ç¯å¢ƒå˜é‡
```

---

## ğŸ”Œ API è®¾è®¡

### è®¤è¯ç›¸å…³ API

#### 1. å‘é€éªŒè¯ç 
- **è·¯å¾„**ï¼š`POST /api/auth/send-code`
- **è¯·æ±‚ä½“**ï¼š
  ```json
  {
    "phone": "13800138000"
  }
  ```
- **å“åº”**ï¼š
  ```json
  {
    "code": 200,
    "msg": "éªŒè¯ç å·²å‘é€"
  }
  ```
- **åŠŸèƒ½**ï¼š
  - éªŒè¯æ‰‹æœºå·æ ¼å¼
  - é˜²åˆ·æ£€æŸ¥ï¼ˆé¢‘ç‡é™åˆ¶ï¼‰
  - ç”Ÿæˆ 6 ä½éªŒè¯ç 
  - å­˜å…¥ MySQL éªŒè¯ç è¡¨ï¼ˆ5 åˆ†é’Ÿè¿‡æœŸï¼‰
  - è°ƒç”¨çŸ­ä¿¡æœåŠ¡å‘é€

#### 2. ç™»å½•/æ³¨å†Œ
- **è·¯å¾„**ï¼š`POST /api/auth/login`
- **è¯·æ±‚ä½“**ï¼š
  ```json
  {
    "phone": "13800138000",
    "code": "123456"
  }
  ```
- **å“åº”**ï¼š
  ```json
  {
    "code": 200,
    "data": {
      "token": "eyJhbGciOiJIUzI1Ni...",
      "is_new_user": true,
      "user": {
        "id": 1,
        "nickname": null,
        "avatar": null
      }
    }
  }
  ```
- **åŠŸèƒ½**ï¼š
  - éªŒè¯éªŒè¯ç ï¼ˆä» MySQL éªŒè¯ç è¡¨è¯»å–ï¼‰
  - æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å­˜åœ¨
  - ä¸å­˜åœ¨åˆ™è‡ªåŠ¨æ³¨å†Œ
  - ç”Ÿæˆ JWT Tokenï¼ˆæ°¸ä¹…æœ‰æ•ˆï¼Œä¸é€€å‡ºå°±ä¸€ç›´æœ‰æ•ˆï¼‰
  - è¿”å›ç”¨æˆ·ä¿¡æ¯

**Token å®ç°è¯´æ˜**ï¼š
- JWT Token ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆ`exp` å­—æ®µä¸è®¾ç½®æˆ–è®¾ç½®ä¸ºå¾ˆè¿œçš„æœªæ¥æ—¶é—´ï¼‰
- Token å­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼ˆlocalStorage æˆ– Cookieï¼‰
- ç”¨æˆ·ä¸»åŠ¨é€€å‡ºç™»å½•æ—¶ï¼Œå‰ç«¯æ¸…é™¤ Token
- å¦‚æœ Token ä¸¢å¤±æˆ–æ¸…é™¤ï¼Œç”¨æˆ·éœ€è¦é‡æ–°ç™»å½•

### æ‰“å¡ç›¸å…³ API

#### 3. æäº¤æ‰“å¡
- **è·¯å¾„**ï¼š`POST /api/checkin`
- **è¯·æ±‚å¤´**ï¼š`Authorization: Bearer <token>`
- **è¯·æ±‚ä½“**ï¼š
  ```json
  {
    "weight": 68.5,
    "photo": "base64_encoded_image_or_url"
  }
  ```
- **åŠŸèƒ½**ï¼š
  - éªŒè¯ Token
  - æ£€æŸ¥æ‰“å¡æ—¶é—´ï¼ˆæ¯å‘¨ä¸€ 00:00-20:00ï¼‰
  - **è‡ªåŠ¨è®¡ç®— weekNumber**ï¼šæ ¹æ®å½“å‰æ—¥æœŸè®¡ç®—å¹´ä»½å’Œå‘¨æ•°ï¼Œæ ¼å¼ä¸º `YYYYWW`ï¼ˆå¦‚ 202451 è¡¨ç¤º 2024 å¹´ç¬¬ 51 å‘¨ï¼‰
  - ä¿å­˜ä½“é‡å’Œç…§ç‰‡
  - è¿”å›æ‰“å¡è®°å½•

**weekNumber è®¡ç®—è¯´æ˜**ï¼š
- API ä¸æ¥æ”¶ `week` æˆ– `week_number` å‚æ•°
- åç«¯æ ¹æ®å½“å‰æ—¥æœŸè‡ªåŠ¨è®¡ç®—ï¼š`weekNumber = å¹´ä»½ * 100 + å‘¨æ•°`
- ä¾‹å¦‚ï¼š2024 å¹´ç¬¬ 51 å‘¨ = `2024 * 100 + 51 = 202451`
- è¿™æ ·å¯ä»¥ç¡®ä¿æ•°æ®å‡†ç¡®æ€§ï¼Œé¿å…å®¢æˆ·ç«¯ä¼ é”™å‘¨æ•°

#### 4. ä¿®æ”¹æ‰“å¡
- **è·¯å¾„**ï¼š`PUT /api/checkin/[id]`
- **åŠŸèƒ½**ï¼šåœ¨ 20:00 å‰å…è®¸ä¿®æ”¹æ‰“å¡æ•°æ®

### æ’è¡Œæ¦œ API

#### 5. è·å–æ’è¡Œæ¦œ
- **è·¯å¾„**ï¼š`GET /api/leaderboard?week=51`
- **å‚æ•°è¯´æ˜**ï¼š
  - `week`ï¼ˆå¯é€‰ï¼‰ï¼šå‘¨æ•°ï¼ˆ1-53ï¼‰ï¼Œä¸ä¼ åˆ™æŸ¥è¯¢å½“å‰å‘¨
- **å“åº”**ï¼š
  ```json
  {
    "code": 200,
    "data": {
      "week": 51,
      "weekNumber": 202451,
      "year": 2024,
      "users": [
        {
          "rank": 1,
          "user_id": 1,
          "nickname": "å¼ ä¸‰",
          "avatar": "...",
          "weight_loss": 2.5,
          "percentage": 3.5
        }
      ]
    }
  }
  ```
- **åŠŸèƒ½**ï¼š
  - å¦‚æœä¼  `week`ï¼Œæ ¹æ®å½“å‰å¹´ä»½è®¡ç®— `weekNumber = å½“å‰å¹´ä»½ * 100 + week`
  - å¦‚æœéƒ½ä¸ä¼ ï¼ŒæŸ¥è¯¢å½“å‰å‘¨çš„æ’è¡Œæ¦œ
  - è¿”å›è¯¥å‘¨çš„æ’åæ•°æ®

**weekNumber æ ¼å¼è¯´æ˜**ï¼š
- æ•°æ®åº“ä¸­çš„ `weekNumber` æ ¼å¼ä¸º `YYYYWW`ï¼ˆå¹´ä»½ + å‘¨æ•°ï¼‰
- ä¾‹å¦‚ï¼š2024 å¹´ç¬¬ 51 å‘¨ = `202451`
- API å‚æ•° `week` åªä¼ å‘¨æ•°ï¼ˆ51ï¼‰ï¼Œåç«¯ä¼šè‡ªåŠ¨åŠ ä¸Šå½“å‰å¹´ä»½è½¬æ¢ä¸º `weekNumber`

### ä¸ªäººä¸»é¡µ API

#### 6. è·å–ç”¨æˆ·ä¿¡æ¯
- **è·¯å¾„**ï¼š`GET /api/profile/[userId]`
- **å“åº”**ï¼š
  ```json
  {
    "code": 200,
    "data": {
      "user": {
        "id": 1,
        "nickname": "å¼ ä¸‰",
        "avatar": "..."
      },
      "weight_trend": [...],
      "certificates": [...]
    }
  }
  ```

### ç®¡ç†å‘˜ API

#### 7. ç»“ç®—æ’å
- **è·¯å¾„**ï¼š`POST /api/admin/settle?week=51`
- **å‚æ•°è¯´æ˜**ï¼š
  - `week`ï¼ˆå¯é€‰ï¼‰ï¼šå‘¨æ•°ï¼ˆ1-53ï¼‰ï¼Œä¸ä¼ åˆ™ç»“ç®—å½“å‰å‘¨
- **åŠŸèƒ½**ï¼š
  - å¦‚æœä¼  `week`ï¼Œæ ¹æ®å½“å‰å¹´ä»½è®¡ç®— `weekNumber = å½“å‰å¹´ä»½ * 100 + week`
  - å¦‚æœéƒ½ä¸ä¼ ï¼Œç»“ç®—å½“å‰å‘¨
  - è®¡ç®—è¯¥å‘¨æ‰€æœ‰ç”¨æˆ·çš„æ’å
  - ç”Ÿæˆå¥–çŠ¶å›¾ç‰‡
  - ä¿å­˜åˆ° rewards è¡¨

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### ä½¿ç”¨ Prisma ORM

### ID å­—æ®µè¯´æ˜

æ‰€æœ‰è¡¨çš„ä¸»é”® ID éƒ½ä½¿ç”¨ä»¥ä¸‹å®šä¹‰ï¼š
```prisma
id  BigInt   @id @default(autoincrement())
```

**è¯´æ˜**ï¼š
- **`@id`**ï¼šè¡¨ç¤ºè¿™æ˜¯ä¸»é”®ï¼ˆPrimary Keyï¼‰ï¼Œå”¯ä¸€æ ‡è¯†æ¯æ¡è®°å½•
- **`BigInt`**ï¼šä½¿ç”¨å¤§æ•´æ•°ç±»å‹ï¼Œæ”¯æŒéå¸¸å¤§çš„æ•°å­—ï¼ˆ-2^63 åˆ° 2^63-1ï¼‰ï¼Œé€‚åˆé•¿æœŸè¿è¡Œçš„åº”ç”¨
- **`@default(autoincrement())`**ï¼šè‡ªåŠ¨é€’å¢ï¼Œæ’å…¥æ–°è®°å½•æ—¶è‡ªåŠ¨ç”Ÿæˆå”¯ä¸€ IDï¼ˆ1, 2, 3, ...ï¼‰

**åœ¨ MySQL ä¸­å¯¹åº”**ï¼š
- Prisma çš„ `BigInt` å¯¹åº” MySQL çš„ `BIGINT` ç±»å‹
- `autoincrement()` å¯¹åº” MySQL çš„ `AUTO_INCREMENT` å±æ€§

**ä¸ºä»€ä¹ˆä½¿ç”¨ BigInt è‡ªå¢ ID è€Œä¸æ˜¯ UUIDï¼Ÿ**

| ç‰¹æ€§ | è‡ªå¢ BigInt ID | UUID |
|------|--------------|------|
| **æ€§èƒ½** | âœ… æŸ¥è¯¢é€Ÿåº¦å¿«ï¼ˆæ•´æ•°ç´¢å¼•ï¼‰ | âŒ å­—ç¬¦ä¸²ç´¢å¼•ï¼Œæ€§èƒ½è¾ƒå·® |
| **å­˜å‚¨ç©ºé—´** | âœ… 8 å­—èŠ‚ | âŒ 36 å­—ç¬¦ï¼ˆçº¦ 36 å­—èŠ‚ï¼‰ |
| **å¯è¯»æ€§** | âœ… ç®€å•ç›´è§‚ï¼ˆ1, 2, 3...ï¼‰ | âŒ å¤æ‚ï¼ˆ550e8400-e29b-41d4-a716-446655440000ï¼‰ |
| **å®‰å…¨æ€§** | âš ï¸ å¯é¢„æµ‹ï¼Œå¯èƒ½æš´éœ²ä¸šåŠ¡ä¿¡æ¯ | âœ… ä¸å¯é¢„æµ‹ï¼Œæ›´å®‰å…¨ |
| **åˆ†å¸ƒå¼** | âŒ éœ€è¦é›†ä¸­ç”Ÿæˆ | âœ… å¯åˆ†å¸ƒå¼ç”Ÿæˆ |
| **æ’åº** | âœ… è‡ªç„¶æœ‰åº | âŒ éœ€è¦é¢å¤–å­—æ®µæ’åº |
| **URL å‹å¥½** | âœ… ç®€çŸ­ï¼ˆ/user/123ï¼‰ | âŒ è¾ƒé•¿ï¼ˆ/user/550e8400-...ï¼‰ |

**æœ¬é¡¹ç›®é€‰æ‹©è‡ªå¢ ID çš„åŸå› **ï¼š
1. âœ… **æ€§èƒ½ä¼˜å…ˆ**ï¼šæ•´æ•°ç´¢å¼•æŸ¥è¯¢é€Ÿåº¦å¿«ï¼Œé€‚åˆé«˜å¹¶å‘åœºæ™¯
2. âœ… **å­˜å‚¨æ•ˆç‡**ï¼šèŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œç‰¹åˆ«æ˜¯ä½œä¸ºå¤–é”®æ—¶
3. âœ… **ç®€å•æ˜“ç”¨**ï¼šID ç®€çŸ­æ˜“è¯»ï¼Œä¾¿äºè°ƒè¯•å’Œæ—¥å¿—è®°å½•
4. âœ… **å•æœºéƒ¨ç½²**ï¼šä¸éœ€è¦åˆ†å¸ƒå¼ ID ç”Ÿæˆ
5. âœ… **URL å‹å¥½**ï¼šAPI è·¯å¾„æ›´ç®€æ´ï¼ˆ`/api/user/123` vs `/api/user/550e8400-...`ï¼‰

**ä»€ä¹ˆæ—¶å€™åº”è¯¥ç”¨ UUIDï¼Ÿ**
- éœ€è¦åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå¤šæ•°æ®åº“åŒæ­¥
- éœ€è¦éšè—ä¸šåŠ¡ä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ·æ•°é‡ï¼‰
- éœ€è¦å®¢æˆ·ç«¯ç”Ÿæˆ IDï¼ˆç¦»çº¿åœºæ™¯ï¼‰
- éœ€è¦è·¨ç³»ç»Ÿåˆå¹¶æ•°æ®

**æœ¬é¡¹ç›®åœºæ™¯**ï¼š
- å•æœºéƒ¨ç½²ï¼Œå•ä¸€ MySQL æ•°æ®åº“
- æ€§èƒ½è¦æ±‚é«˜ï¼ˆæ’è¡Œæ¦œæŸ¥è¯¢é¢‘ç¹ï¼‰
- ä¸éœ€è¦éšè—ä¸šåŠ¡ä¿¡æ¯
- å› æ­¤é€‰æ‹©è‡ªå¢ BigInt ID æ›´åˆé€‚

#### 1. ç”¨æˆ·è¡¨ (users)
```prisma
model User {
  id        BigInt   @id @default(autoincrement())
  nickname  String?
  avatar    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  auths     UserAuth[]
  checkins  Checkin[]
  rewards   Reward[]
}
```

#### 2. ç”¨æˆ·æˆæƒè¡¨ (user_auths)
```prisma
model UserAuth {
  id           BigInt   @id @default(autoincrement())
  userId       BigInt
  identityType String   // 'phone', 'wechat', 'github'
  identifier   String   // æ‰‹æœºå·ã€OpenID ç­‰
  credential   String?  // å¯†ç  Hashï¼ˆæ‰‹æœºç™»å½•ä¸ºç©ºï¼‰
  lastLoginAt  DateTime?
  
  user         User     @relation(fields: [userId], references: [id])
  
  @@unique([identityType, identifier])
  @@index([userId])
}
```

#### 3. æ‰“å¡è®°å½•è¡¨ (checkins)
```prisma
model Checkin {
  id         BigInt   @id @default(autoincrement())
  userId     BigInt
  weight     Decimal  @db.Decimal(5, 2)
  photoUrl   String
  weekNumber Int      // å¦‚ 202451
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  
  user       User     @relation(fields: [userId], references: [id])
  
  @@unique([userId, weekNumber])
  @@index([weekNumber])
}
```

#### 4. æ’åä¸å¥–åŠ±è¡¨ (rewards)
```prisma
model Reward {
  id              BigInt   @id @default(autoincrement())
  userId          BigInt
  weekNumber      Int
  weightDiff      Decimal  @db.Decimal(5, 2) // å‡é‡å·®å€¼
  rank            Int      // æ’å
  certificateUrl  String?  // å¥–çŠ¶å›¾ç‰‡ URL
  type            Int      // 1=å† å†›, 2=äºšå†›, 3=å­£å†›, 4=å‚ä¸
  createdAt       DateTime  @default(now())
  
  user            User      @relation(fields: [userId], references: [id])
  
  @@unique([userId, weekNumber])
  @@index([weekNumber, rank])
}
```

#### 5. å¥–çŠ¶é…ç½®è¡¨ (cert_configs)
```prisma
model CertConfig {
  id           BigInt   @id @default(autoincrement())
  weekNumber   Int?     // null è¡¨ç¤ºé»˜è®¤æ¨¡æ¿
  imgGold      String   // å† å†›åº•å›¾
  imgSilver    String   // äºšå†›åº•å›¾
  imgBronze    String   // å­£å†›åº•å›¾
  imgParticipate String // å‚ä¸å¥–åº•å›¾
  createdAt    DateTime @default(now())
  
  @@unique([weekNumber])
}
```

#### 6. éªŒè¯ç è¡¨ (verification_codes)
```prisma
model VerificationCode {
  id        BigInt   @id @default(autoincrement())
  phone     String   // æ‰‹æœºå·
  code      String   // 6ä½éªŒè¯ç 
  expiresAt DateTime // è¿‡æœŸæ—¶é—´ï¼ˆ5åˆ†é’Ÿåï¼‰
  createdAt DateTime @default(now())
  used      Boolean  @default(false) // æ˜¯å¦å·²ä½¿ç”¨
  
  @@index([phone, expiresAt])
  @@index([expiresAt]) // ç”¨äºæ¸…ç†è¿‡æœŸéªŒè¯ç 
}
```

### æ•°æ®åº“è¯´æ˜

- **å•ä¸€æ•°æ®åº“**ï¼šåªä½¿ç”¨ MySQLï¼Œç®€åŒ–éƒ¨ç½²å’Œç»´æŠ¤
- **éªŒè¯ç å­˜å‚¨**ï¼šå­˜å‚¨åœ¨ MySQL è¡¨ä¸­ï¼Œé€šè¿‡å®šæ—¶ä»»åŠ¡æ¸…ç†è¿‡æœŸæ•°æ®
- **æ— éœ€ Redis**ï¼šå‡å°‘ä¾èµ–ï¼Œé™ä½å¤æ‚åº¦

---

## ğŸ”„ å¼€å‘æµç¨‹

### 1. é¡¹ç›®åˆå§‹åŒ–

```bash
# åˆ›å»º Next.js 16 é¡¹ç›®
npx create-next-app@latest weighin-app --typescript --tailwind --app

# å®‰è£…ä¾èµ–
cd weighin-app
pnpm install

# åˆå§‹åŒ– shadcn/ui
npx shadcn@latest init

# å®‰è£… shadcn/ui ç»„ä»¶
npx shadcn@latest add button card input label avatar select tabs chart
npx shadcn@latest add alert-dialog dialog

# å®‰è£…çŠ¶æ€ç®¡ç†
pnpm add zustand

# å®‰è£… Prisma
pnpm add prisma @prisma/client
pnpm add -D prisma

# åˆå§‹åŒ– Prisma
npx prisma init
```

### 2. æ•°æ®åº“è®¾ç½®

```bash
# é…ç½® .env
DATABASE_URL="mysql://user:password@localhost:3306/weighin"

# åˆ›å»ºæ•°æ®åº“æ¨¡å‹ï¼ˆåœ¨ prisma/schema.prismaï¼‰
# è¿è¡Œè¿ç§»
npx prisma migrate dev --name init

# ç”Ÿæˆ Prisma Client
npx prisma generate

# å¯é€‰ï¼šè®¾ç½®å®šæ—¶ä»»åŠ¡æ¸…ç†è¿‡æœŸéªŒè¯ç ï¼ˆä½¿ç”¨ cron æˆ– Node.js å®šæ—¶å™¨ï¼‰
```

### 3. å¼€å‘æ­¥éª¤

1. **åˆ›å»ºæ•°æ®åº“æ¨¡å‹**ï¼šåœ¨ `prisma/schema.prisma` ä¸­å®šä¹‰è¡¨ç»“æ„
2. **é…ç½® shadcn/ui**ï¼šåˆå§‹åŒ–å¹¶å®‰è£…éœ€è¦çš„ç»„ä»¶
3. **åˆ›å»º Zustand Store**ï¼šå®šä¹‰å…¨å±€çŠ¶æ€ç®¡ç†
4. **åˆ›å»º API Routes**ï¼šåœ¨ `app/api/` ä¸‹åˆ›å»ºæ¥å£
5. **è¿ç§»å‰ç«¯ç»„ä»¶**ï¼šå°†ç°æœ‰ç»„ä»¶è¿ç§»åˆ° `app/` ç›®å½•ï¼Œä½¿ç”¨ shadcn/ui ç»„ä»¶
6. **å®ç°ä¸šåŠ¡é€»è¾‘**ï¼šåœ¨ API Routes ä¸­å®ç°åç«¯é€»è¾‘
7. **è¿æ¥çŠ¶æ€ç®¡ç†**ï¼šåœ¨ç»„ä»¶ä¸­ä½¿ç”¨ Zustand Store
8. **æµ‹è¯•**ï¼šæµ‹è¯•å„ä¸ªåŠŸèƒ½æ¨¡å—

### 4. æ–‡ä»¶è·¯ç”±è¯´æ˜

Next.js App Router ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿè·¯ç”±ï¼š

- `app/page.tsx` â†’ `/`
- `app/login/page.tsx` â†’ `/login`
- `app/home/page.tsx` â†’ `/home`
- `app/profile/[userId]/page.tsx` â†’ `/profile/123`ï¼ˆåŠ¨æ€è·¯ç”±ï¼‰
- `app/api/auth/login/route.ts` â†’ `POST /api/auth/login`

---

## ğŸš€ éƒ¨ç½²æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šVercelï¼ˆæ¨èï¼‰

1. **è¿æ¥ GitHub**ï¼šå°†ä»£ç æ¨é€åˆ° GitHub
2. **å¯¼å…¥é¡¹ç›®**ï¼šåœ¨ Vercel ä¸­å¯¼å…¥é¡¹ç›®
3. **é…ç½®ç¯å¢ƒå˜é‡**ï¼šè®¾ç½®æ•°æ®åº“è¿æ¥ç­‰
4. **è‡ªåŠ¨éƒ¨ç½²**ï¼šæ¯æ¬¡ push è‡ªåŠ¨éƒ¨ç½²

### æ–¹æ¡ˆ 2ï¼šDocker + äº‘æœåŠ¡å™¨

1. **åˆ›å»º Dockerfile**ï¼š
   ```dockerfile
   FROM node:18-alpine
   WORKDIR /app
   COPY package*.json ./
   RUN npm install
   COPY . .
   RUN npm run build
   CMD ["npm", "start"]
   ```

2. **éƒ¨ç½²åˆ°æœåŠ¡å™¨**ï¼š
   - ä½¿ç”¨ Docker Compose
   - é…ç½® Nginx åå‘ä»£ç†
   - è¿æ¥ MySQL æ•°æ®åº“

### æ–¹æ¡ˆ 3ï¼šä¼ ç»ŸæœåŠ¡å™¨éƒ¨ç½²

1. **æ„å»ºé¡¹ç›®**ï¼š`npm run build`
2. **å¯åŠ¨æœåŠ¡**ï¼š`npm start`
3. **ä½¿ç”¨ PM2**ï¼šè¿›ç¨‹ç®¡ç†
4. **é…ç½® Nginx**ï¼šåå‘ä»£ç†

---

## ğŸ“ è¿ç§»è®¡åˆ’

### é˜¶æ®µ 1ï¼šé¡¹ç›®åˆå§‹åŒ–
- [ ] åˆ›å»º Next.js 16 é¡¹ç›®
- [ ] é…ç½® TypeScript å’Œ Tailwind CSS
- [ ] åˆå§‹åŒ– shadcn/ui
- [ ] å®‰è£… shadcn/ui ç»„ä»¶
- [ ] å®‰è£… Zustand çŠ¶æ€ç®¡ç†
- [ ] å®‰è£…å…¶ä»–å¿…è¦ä¾èµ–

### é˜¶æ®µ 2ï¼šæ•°æ®åº“è®¾ç½®
- [ ] è®¾è®¡æ•°æ®åº“æ¨¡å‹
- [ ] é…ç½® Prisma
- [ ] åˆ›å»ºæ•°æ®åº“è¿ç§»

### é˜¶æ®µ 3ï¼šAPI å¼€å‘
- [ ] å®ç°è®¤è¯ APIï¼ˆå‘é€éªŒè¯ç ã€ç™»å½•ï¼‰
- [ ] å®ç°æ‰“å¡ API
- [ ] å®ç°æ’è¡Œæ¦œ API
- [ ] å®ç°ä¸ªäººä¸»é¡µ API

### é˜¶æ®µ 4ï¼šå‰ç«¯è¿ç§»
- [ ] åˆ›å»º Zustand Storeï¼ˆè®¤è¯ã€UIã€æ‰“å¡ç­‰ï¼‰
- [ ] è¿ç§»ç»„ä»¶åˆ° `app/` ç›®å½•
- [ ] æ›¿æ¢ä¸º shadcn/ui ç»„ä»¶
- [ ] é›†æˆ Zustand çŠ¶æ€ç®¡ç†
- [ ] é…ç½®è·¯ç”±
- [ ] è¿æ¥ API æ¥å£
- [ ] æµ‹è¯•åŠŸèƒ½

### é˜¶æ®µ 5ï¼šåŠŸèƒ½å®Œå–„
- [ ] å®ç°ç»“ç®—é€»è¾‘
- [ ] å®ç°å¥–çŠ¶ç”Ÿæˆ
- [ ] å®ç°ç®¡ç†å‘˜åŠŸèƒ½
- [ ] ä¼˜åŒ–æ€§èƒ½

---

## ğŸ” å®‰å…¨è€ƒè™‘

### 1. è®¤è¯å®‰å…¨
- JWT Token æ°¸ä¹…æœ‰æ•ˆï¼ˆä¸é€€å‡ºç™»å½•å°±ä¸€ç›´æœ‰æ•ˆï¼‰
- Token å­˜å‚¨åœ¨ HttpOnly Cookieï¼ˆæ¨èï¼‰æˆ– localStorage
- ç”¨æˆ·ä¸»åŠ¨é€€å‡ºç™»å½•æ—¶æ¸…é™¤ Token
- éªŒè¯ç é˜²åˆ·æœºåˆ¶

### 2. API å®‰å…¨
- æ‰€æœ‰ API éœ€è¦ Token éªŒè¯ï¼ˆé™¤äº†ç™»å½•æ¥å£ï¼‰
- ä½¿ç”¨ä¸­é—´ä»¶éªŒè¯æƒé™
- é˜²æ­¢ SQL æ³¨å…¥ï¼ˆä½¿ç”¨ Prisma ORMï¼‰

### 3. æ•°æ®å®‰å…¨
- æ•æ„Ÿæ•°æ®åŠ å¯†
- å›¾ç‰‡ä¸Šä¼ é™åˆ¶å¤§å°å’Œç±»å‹
- é˜²æ­¢ XSS æ”»å‡»

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. å‰ç«¯ä¼˜åŒ–
- ä½¿ç”¨ Next.js çš„ Image ç»„ä»¶ä¼˜åŒ–å›¾ç‰‡
- ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½
- ä½¿ç”¨ React.memo ä¼˜åŒ–ç»„ä»¶æ¸²æŸ“
- Zustand é€‰æ‹©å™¨ä¼˜åŒ–ï¼ˆåªè®¢é˜…éœ€è¦çš„çŠ¶æ€ï¼‰
- shadcn/ui ç»„ä»¶æŒ‰éœ€åŠ è½½

### 2. åç«¯ä¼˜åŒ–
- æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
- MySQL æŸ¥è¯¢ä¼˜åŒ–
- API å“åº”å‹ç¼©
- å®šæ—¶æ¸…ç†è¿‡æœŸéªŒè¯ç ï¼ˆé¿å…è¡¨æ•°æ®è¿‡å¤šï¼‰

### 3. æ•°æ®åº“ä¼˜åŒ–
- åˆç†ä½¿ç”¨ç´¢å¼•
- åˆ†é¡µæŸ¥è¯¢
- é¿å… N+1 æŸ¥è¯¢é—®é¢˜

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### 1. API æµ‹è¯•
- ä½¿ç”¨ Postman æˆ– Insomnia æµ‹è¯•æ¥å£
- ç¼–å†™ API æµ‹è¯•ç”¨ä¾‹

### 2. å‰ç«¯æµ‹è¯•
- ç»„ä»¶å•å…ƒæµ‹è¯•ï¼ˆJest + React Testing Libraryï¼‰
- E2E æµ‹è¯•ï¼ˆPlaywrightï¼‰

---

## ğŸ¨ UI ç»„ä»¶åº“ï¼šshadcn/ui

### ä¸ºä»€ä¹ˆé€‰æ‹© shadcn/uiï¼Ÿ

1. **å¯å®šåˆ¶æ€§å¼º**ï¼šç»„ä»¶ä»£ç ç›´æ¥åœ¨ä½ çš„é¡¹ç›®ä¸­ï¼Œå¯ä»¥å®Œå…¨è‡ªå®šä¹‰
2. **åŸºäº Radix UI**ï¼šæ— éšœç¢æ€§ä¼˜ç§€ï¼Œç»„ä»¶è´¨é‡é«˜
3. **Tailwind CSS**ï¼šä¸é¡¹ç›®æ ·å¼ç³»ç»Ÿå®Œç¾é›†æˆ
4. **TypeScript**ï¼šå®Œæ•´çš„ç±»å‹æ”¯æŒ
5. **æŒ‰éœ€å®‰è£…**ï¼šåªå®‰è£…éœ€è¦çš„ç»„ä»¶ï¼Œä¸å¢åŠ åŒ…ä½“ç§¯

### å¸¸ç”¨ç»„ä»¶

- **åŸºç¡€ç»„ä»¶**ï¼šButton, Card, Input, Label, Avatar, Select, Tabs
- **åé¦ˆç»„ä»¶**ï¼šAlert, AlertDialog, Dialog, Toast
- **æ•°æ®å±•ç¤º**ï¼šChartï¼ˆåŸºäº Recharts å°è£…ï¼‰
- **è¡¨å•ç»„ä»¶**ï¼šForm, Checkbox, Radio, Switch

### å®‰è£…æ–¹å¼

```bash
# åˆå§‹åŒ–ï¼ˆé…ç½® tailwind.config.ts å’Œ components.jsonï¼‰
npx shadcn@latest init

# å®‰è£…ç»„ä»¶
npx shadcn@latest add button
npx shadcn@latest add card
npx shadcn@latest add chart
npx shadcn@latest add form
```

---

## ğŸ“ è¡¨å•å¤„ç†ï¼šReact Hook Form + shadcn/ui Form

### ä¸ºä»€ä¹ˆé€‰æ‹© React Hook Formï¼Ÿ

åœ¨ Next.js ä¸­ï¼Œè¡¨å•å¤„ç†æ¨èä½¿ç”¨ **React Hook Form + shadcn/ui Form** çš„ç»„åˆï¼š

1. **æ€§èƒ½ä¼˜ç§€**ï¼šéå—æ§ç»„ä»¶ï¼Œå‡å°‘é‡æ¸²æŸ“
2. **ä½“ç§¯å°**ï¼šåŒ…ä½“ç§¯å°ï¼ˆ~9KBï¼‰
3. **TypeScript æ”¯æŒ**ï¼šå®Œæ•´çš„ç±»å‹æ¨æ–­
4. **éªŒè¯çµæ´»**ï¼šæ”¯æŒå¤šç§éªŒè¯åº“ï¼ˆZodã€Yup ç­‰ï¼‰
5. **ä¸ shadcn/ui å®Œç¾é›†æˆ**ï¼šshadcn/ui Form ç»„ä»¶å°±æ˜¯åŸºäº React Hook Form æ„å»ºçš„

### å®‰è£…ä¾èµ–

```bash
# React Hook Formï¼ˆshadcn/ui form ç»„ä»¶å·²åŒ…å«ï¼‰
pnpm add react-hook-form

# å¯é€‰ï¼šä½¿ç”¨ Zod è¿›è¡Œè¡¨å•éªŒè¯
pnpm add zod @hookform/resolvers
```

### åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹

#### 1. ç™»å½•è¡¨å•ç¤ºä¾‹

```typescript
"use client"

import { useForm } from "react-hook-form"
import { zodResolver } from "@hookform/resolvers/zod"
import * as z from "zod"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from "@/components/ui/form"

// å®šä¹‰è¡¨å•éªŒè¯è§„åˆ™
const loginSchema = z.object({
  phone: z.string().regex(/^1[3-9]\d{9}$/, "è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·"),
  code: z.string().length(6, "éªŒè¯ç ä¸º6ä½æ•°å­—"),
})

type LoginFormValues = z.infer<typeof loginSchema>

export function LoginForm() {
  const form = useForm<LoginFormValues>({
    resolver: zodResolver(loginSchema),
    defaultValues: {
      phone: "",
      code: "",
    },
  })

  const onSubmit = async (data: LoginFormValues) => {
    // è°ƒç”¨ API
    const response = await fetch("/api/auth/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data),
    })
    // å¤„ç†å“åº”...
  }

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
        <FormField
          control={form.control}
          name="phone"
          render={({ field }) => (
            <FormItem>
              <FormLabel>æ‰‹æœºå·</FormLabel>
              <FormControl>
                <Input placeholder="è¯·è¾“å…¥æ‰‹æœºå·" {...field} />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />
        
        <FormField
          control={form.control}
          name="code"
          render={({ field }) => (
            <FormItem>
              <FormLabel>éªŒè¯ç </FormLabel>
              <FormControl>
                <Input placeholder="è¯·è¾“å…¥éªŒè¯ç " {...field} />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />
        
        <Button type="submit" className="w-full">
          ç™»å½• / æ³¨å†Œ
        </Button>
      </form>
    </Form>
  )
}
```

#### 2. æ‰“å¡è¡¨å•ç¤ºä¾‹ï¼ˆå¸¦æ–‡ä»¶ä¸Šä¼ ï¼‰

```typescript
"use client"

import { useForm } from "react-hook-form"
import { zodResolver } from "@hookform/resolvers/zod"
import * as z from "zod"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
  FormDescription,
} from "@/components/ui/form"

const checkinSchema = z.object({
  weight: z.number().min(30).max(200),
  photo: z.instanceof(File).optional(),
})

type CheckinFormValues = z.infer<typeof checkinSchema>

export function CheckinForm() {
  const form = useForm<CheckinFormValues>({
    resolver: zodResolver(checkinSchema),
    defaultValues: {
      weight: undefined,
      photo: undefined,
    },
  })

  const onSubmit = async (data: CheckinFormValues) => {
    const formData = new FormData()
    formData.append("weight", data.weight.toString())
    if (data.photo) {
      formData.append("photo", data.photo)
    }

    const response = await fetch("/api/checkin", {
      method: "POST",
      body: formData,
    })
    // å¤„ç†å“åº”...
  }

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-6">
        <FormField
          control={form.control}
          name="weight"
          render={({ field }) => (
            <FormItem>
              <FormLabel>ä½“é‡ (kg)</FormLabel>
              <FormControl>
                <Input
                  type="number"
                  step="0.1"
                  placeholder="è¯·è¾“å…¥ä½“é‡"
                  {...field}
                  onChange={(e) => field.onChange(parseFloat(e.target.value))}
                />
              </FormControl>
              <FormDescription>è¯·è¾“å…¥å½“å‰ä½“é‡ï¼Œç²¾ç¡®åˆ°å°æ•°ç‚¹åä¸€ä½</FormDescription>
              <FormMessage />
            </FormItem>
          )}
        />
        
        <FormField
          control={form.control}
          name="photo"
          render={({ field: { value, onChange, ...field } }) => (
            <FormItem>
              <FormLabel>ç…§ç‰‡</FormLabel>
              <FormControl>
                <Input
                  type="file"
                  accept="image/*"
                  {...field}
                  onChange={(e) => {
                    const file = e.target.files?.[0]
                    onChange(file)
                  }}
                />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />
        
        <Button type="submit">æäº¤æ‰“å¡</Button>
      </form>
    </Form>
  )
}
```

### ä¸ Next.js Server Actions é›†æˆ

Next.js 16 æ”¯æŒ Server Actionsï¼Œå¯ä»¥ç›´æ¥åœ¨è¡¨å•ä¸­ä½¿ç”¨ï¼š

```typescript
"use client"

import { useForm } from "react-hook-form"
import { useActionState } from "react"
import { loginAction } from "@/app/actions/auth"

export function LoginForm() {
  const [state, formAction, isPending] = useActionState(loginAction, null)
  
  const form = useForm({
    defaultValues: { phone: "", code: "" },
  })

  return (
    <Form {...form}>
      <form action={formAction}>
        {/* è¡¨å•å­—æ®µ */}
      </form>
    </Form>
  )
}
```

### éªŒè¯åº“é€‰æ‹©

#### æ¨èï¼šZodï¼ˆä¸ TypeScript å®Œç¾é›†æˆï¼‰

```bash
pnpm add zod @hookform/resolvers
```

**ä¼˜ç‚¹**ï¼š
- TypeScript åŸç”Ÿæ”¯æŒ
- ç±»å‹æ¨æ–­è‡ªåŠ¨ç”Ÿæˆ
- è¯­æ³•ç®€æ´
- æ€§èƒ½å¥½

#### å…¶ä»–é€‰æ‹©

- **Yup**ï¼šåŠŸèƒ½å¼ºå¤§ï¼Œä½†ä½“ç§¯è¾ƒå¤§
- **Joi**ï¼šNode.js å¸¸ç”¨ï¼Œä½†æµè§ˆå™¨ç«¯ä½“ç§¯å¤§
- **è‡ªå®šä¹‰éªŒè¯**ï¼šä½¿ç”¨ React Hook Form çš„ `validate` å‡½æ•°

### æœ€ä½³å®è·µ

1. **ä½¿ç”¨ Zod è¿›è¡ŒéªŒè¯**ï¼šç±»å‹å®‰å…¨ï¼Œè‡ªåŠ¨æ¨æ–­
2. **åˆ†ç¦»éªŒè¯é€»è¾‘**ï¼šå°† schema å®šä¹‰åœ¨å•ç‹¬æ–‡ä»¶ä¸­
3. **é”™è¯¯å¤„ç†**ï¼šä½¿ç”¨ `FormMessage` æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
4. **åŠ è½½çŠ¶æ€**ï¼šä½¿ç”¨ `form.formState.isSubmitting` æ˜¾ç¤ºåŠ è½½çŠ¶æ€
5. **é‡ç½®è¡¨å•**ï¼šæäº¤æˆåŠŸåä½¿ç”¨ `form.reset()` é‡ç½®è¡¨å•

### å¸¸ç”¨ Hook

```typescript
const form = useForm()

// è¡¨å•çŠ¶æ€
form.formState.isDirty      // è¡¨å•æ˜¯å¦è¢«ä¿®æ”¹
form.formState.isValid      // è¡¨å•æ˜¯å¦æœ‰æ•ˆ
form.formState.isSubmitting // æ˜¯å¦æ­£åœ¨æäº¤
form.formState.errors       // é”™è¯¯ä¿¡æ¯

// è¡¨å•æ–¹æ³•
form.reset()                // é‡ç½®è¡¨å•
form.setValue()             // è®¾ç½®å­—æ®µå€¼
form.getValues()            // è·å–è¡¨å•å€¼
form.watch()                // ç›‘å¬å­—æ®µå˜åŒ–
form.trigger()              // æ‰‹åŠ¨è§¦å‘éªŒè¯
```

---

## ğŸ—‚ï¸ çŠ¶æ€ç®¡ç†ï¼šZustand

### ä¸ºä»€ä¹ˆé€‰æ‹© Zustandï¼Ÿ

1. **è½»é‡çº§**ï¼šåŒ…ä½“ç§¯å°ï¼ˆ< 1KBï¼‰
2. **ç®€å•æ˜“ç”¨**ï¼šAPI ç®€æ´ï¼Œå­¦ä¹ æˆæœ¬ä½
3. **TypeScript æ”¯æŒ**ï¼šå®Œæ•´çš„ç±»å‹æ¨æ–­
4. **æ€§èƒ½ä¼˜ç§€**ï¼šåªæ›´æ–°è®¢é˜…çš„ç»„ä»¶
5. **æ— éœ€ Provider**ï¼šä¸éœ€è¦åŒ…è£¹æ•´ä¸ªåº”ç”¨

### Store è®¾è®¡ç¤ºä¾‹

#### è®¤è¯çŠ¶æ€ (auth-store.ts)
```typescript
import { create } from 'zustand'
import { persist } from 'zustand/middleware'

interface AuthState {
  token: string | null
  user: User | null
  isLoggedIn: boolean
  login: (token: string, user: User) => void
  logout: () => void
}

export const useAuthStore = create<AuthState>()(
  persist(
    (set) => ({
      token: null,
      user: null,
      isLoggedIn: false,
      login: (token, user) => set({ token, user, isLoggedIn: true }),
      logout: () => set({ token: null, user: null, isLoggedIn: false }),
    }),
    { name: 'auth-storage' }
  )
)
```

#### UI çŠ¶æ€ (ui-store.ts)
```typescript
import { create } from 'zustand'

interface UIState {
  currentPage: 'home' | 'checkin' | 'leaderboard' | 'profile' | 'halloffame'
  viewingUserId: number | null
  setCurrentPage: (page: UIState['currentPage']) => void
  setViewingUserId: (id: number | null) => void
}

export const useUIStore = create<UIState>((set) => ({
  currentPage: 'home',
  viewingUserId: null,
  setCurrentPage: (page) => set({ currentPage: page }),
  setViewingUserId: (id) => set({ viewingUserId: id }),
}))
```

### åœ¨ç»„ä»¶ä¸­ä½¿ç”¨

```typescript
import { useAuthStore } from '@/store/auth-store'
import { useUIStore } from '@/store/ui-store'

export function Dashboard() {
  const { user, isLoggedIn } = useAuthStore()
  const { setCurrentPage } = useUIStore()
  
  // ...
}
```

---

## ğŸ“š å‚è€ƒèµ„æº

- [Next.js 16 å®˜æ–¹æ–‡æ¡£](https://nextjs.org/docs)
- [shadcn/ui æ–‡æ¡£](https://ui.shadcn.com)
- [Zustand æ–‡æ¡£](https://docs.pmnd.rs/zustand)
- [Prisma æ–‡æ¡£](https://www.prisma.io/docs)
- [Tailwind CSS æ–‡æ¡£](https://tailwindcss.com/docs)

---

## âœ… æ€»ç»“

ä½¿ç”¨ Next.js 16 + shadcn/ui + Zustand + MySQL çš„ä¼˜åŠ¿ï¼š
1. âœ… **å…¨æ ˆå¼€å‘**ï¼šå‰åç«¯ç»Ÿä¸€æŠ€æœ¯æ ˆ
2. âœ… **ç®€åŒ–éƒ¨ç½²**ï¼šä¸€ä¸ªé¡¹ç›®ï¼Œä¸€æ¬¡éƒ¨ç½²
3. âœ… **å•ä¸€æ•°æ®åº“**ï¼šåªä½¿ç”¨ MySQLï¼Œæ— éœ€ Redisï¼Œé™ä½å¤æ‚åº¦
4. âœ… **å¼€å‘æ•ˆç‡**ï¼šæ–‡ä»¶è·¯ç”±ï¼Œè‡ªåŠ¨ä¼˜åŒ–
5. âœ… **UI ç»„ä»¶**ï¼šshadcn/ui å¯å®šåˆ¶ã€é«˜è´¨é‡ç»„ä»¶
6. âœ… **çŠ¶æ€ç®¡ç†**ï¼šZustand è½»é‡çº§ã€ç®€å•æ˜“ç”¨
7. âœ… **å®‰å…¨æ€§**ï¼šä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ï¼Œæ— å·²çŸ¥æ¼æ´
8. âœ… **æ˜“äºæ‰©å±•**ï¼šåç»­å¯ä»¥è½»æ¾æ·»åŠ  SSRã€SSG ç­‰åŠŸèƒ½

å¯¹äº WeighIn è¿™ä¸ªé¡¹ç›®ï¼Œè¿™ä¸ªæŠ€æœ¯æ ˆæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå¯ä»¥å¿«é€Ÿå¼€å‘å¹¶éƒ¨ç½²ã€‚å•ä¸€æ•°æ®åº“æ¶æ„ç®€åŒ–äº†è¿ç»´å’Œéƒ¨ç½²æµç¨‹ã€‚

---

*æœ€åæ›´æ–°ï¼š2025å¹´12æœˆ*

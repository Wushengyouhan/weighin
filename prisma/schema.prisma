generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id        BigInt     @id @default(autoincrement()) @db.UnsignedBigInt
  nickname  String?    @db.VarChar(50)
  avatar    String?    @db.VarChar(500)
  createdAt DateTime   @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt DateTime   @default(now()) @updatedAt @map("updated_at") @db.DateTime(0)
  checkins  checkins[]
  rewards   rewards[]
  auths     UserAuth[]

  @@index([createdAt], map: "idx_created_at")
  @@map("users")
}

model UserAuth {
  id           BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  userId       BigInt    @map("user_id") @db.UnsignedBigInt
  identityType String    @map("identity_type") @db.VarChar(20)
  identifier   String    @db.VarChar(64)
  credential   String?   @db.VarChar(255)
  lastLoginAt  DateTime? @map("last_login_at") @db.DateTime(0)
  createdAt    DateTime  @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt    DateTime  @default(now()) @updatedAt @map("updated_at") @db.DateTime(0)
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_user_auths_user_id")

  @@unique([identityType, identifier], map: "uk_identity")
  @@index([lastLoginAt], map: "idx_last_login_at")
  @@index([userId], map: "idx_user_id")
  @@map("user_auths")
}

model VerificationCode {
  id        BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  phone     String   @db.VarChar(20)
  code      String   @db.VarChar(6)
  expiresAt DateTime @map("expires_at") @db.DateTime(0)
  used      Boolean  @default(false)
  createdAt DateTime @default(now()) @map("created_at") @db.DateTime(0)

  @@index([expiresAt], map: "idx_expires_at")
  @@index([phone, expiresAt], map: "idx_phone_expires")
  @@map("verification_codes")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model cert_configs {
  id              BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  week_number     Int?     @unique(map: "uk_week_number") @db.UnsignedInt
  img_gold        String   @db.VarChar(500)
  img_silver      String   @db.VarChar(500)
  img_bronze      String   @db.VarChar(500)
  img_participate String   @db.VarChar(500)
  created_at      DateTime @default(now()) @db.DateTime(0)
  updated_at      DateTime @default(now()) @db.DateTime(0)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model checkins {
  id          BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  user_id     BigInt   @db.UnsignedBigInt
  weight      Decimal  @db.Decimal(5, 2)
  photo_url   String   @db.VarChar(500)
  week_number Int      @db.UnsignedInt
  created_at  DateTime @default(now()) @db.DateTime(0)
  updated_at  DateTime @default(now()) @db.DateTime(0)
  users       User     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_checkins_user_id")

  @@unique([user_id, week_number], map: "uk_user_week")
  @@index([created_at], map: "idx_created_at")
  @@index([user_id], map: "idx_user_id")
  @@index([week_number], map: "idx_week_number")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model rewards {
  id              BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  user_id         BigInt   @db.UnsignedBigInt
  week_number     Int      @db.UnsignedInt
  weight_diff     Decimal  @db.Decimal(5, 2)
  rank            Int      @db.UnsignedInt
  certificate_url String?  @db.VarChar(500)
  type            Int      @db.UnsignedTinyInt
  created_at      DateTime @default(now()) @db.DateTime(0)
  users           User     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_rewards_user_id")

  @@unique([user_id, week_number], map: "uk_user_week")
  @@index([user_id], map: "idx_user_id")
  @@index([week_number], map: "idx_week_number")
  @@index([week_number, rank], map: "idx_week_rank")
}
